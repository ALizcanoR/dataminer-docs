---
uid: OpenSearch_database
---

# OpenSearch database

From DataMiner 10.3.0/10.3.3 onwards, it is possible to install a dedicated OpenSearch indexing database cluster as an alternative for Elasticsearch. This indexing cluster also requires a Cassandra cluster.

> [!NOTE]
> If you are looking to use the Amazon OpenSearch Service instead of on-prem hosted OpenSearch nodes, see [Amazon OpenSearch Service](xref:Amazon_OpenSearch_Service).

## Compatibility

Supported versions:

- OpenSearch 1.X
- OpenSearch 2.X

## Setting up the OpenSearch cluster(on premises)

> [!NOTE]
> Below steps were conducted following the Debian installation guide at [Debian](https://opensearch.org/docs/latest/install-and-configure/install-opensearch/debian/) on a Ubuntu Server system.

1. Install OpenSearch using the [Install OpenSearch from an APT repository](https://opensearch.org/docs/latest/install-and-configure/install-opensearch/debian/#install-opensearch-from-an-apt-repository) topic of the installation guide.
1. Follow [Step 2:(Optional) Test OpenSearch](https://opensearch.org/docs/latest/install-and-configure/install-opensearch/debian/#step-2-optional-test-opensearch) from the guide, don't forget to also query the plugins endpoint.
1. Follow [Step 3: Set up OpenSearch in your environment](https://opensearch.org/docs/latest/install-and-configure/install-opensearch/debian/#step-3-set-up-opensearch-in-your-environment) and change the *JVM Heap Space*.
1. In addition to the guide on [Creating a cluster](https://opensearch.org/docs/latest/tuning-your-cluster/cluster/) follow below steps.

> [!IMPORTANT]

> - On production systems, the *JVM Heap Space* must be set to a value larger than the default. To configure this setting, see [Important settings](https://opensearch.org/docs/latest/install-and-configure/install-opensearch/index/#important-settings).
> - The `indices.query.bool.max_clause_count` setting should be set to "2147483647" (i.e. the maximum integer value).

### OpenSearch.yml configuration

For every node in your cluster configure the following in OpenSearch.yml(below is an example of three nodes):

```yml
# Use a descriptive name for your cluster:
#
cluster.name: NameOfYourCluster
cluster.initial_master_nodes: ["opensearchnode1"]
#
# ------------------------------------ Node ------------------------------------
#
# Use a descriptive name for the node(node.name can be anything you desire, but we recommend hostname of node):
#
#Make the node.name reflect the name of your node
node.name: opensearchnode1
#
# ----------------------------------- Paths ------------------------------------
#
# Path to directory where to store the data (separate multiple locations by comma):
#
path.data: /var/lib/opensearch
#
# Path to log files:
#
path.logs: /var/log/opensearch
# ---------------------------------- Network -----------------------------------
#
# Set the bind address to a specific IP (IPv4 or IPv6), best is to use the real-ip of the node:
#
network.host: ipAddressOfTheNode

network.publish_host: ipAddressOfTheNode
#
# Set a custom port for HTTP:
#
http.port: 9200
#
# For more information, consult the network module documentation.
#
# --------------------------------- Discovery ----------------------------------
#
# Pass an initial list of hosts to perform discovery when this node is started:
# The default list of hosts is ["127.0.0.1", "[::1]"]
#
discovery.seed_hosts: ["ipAddressOfTheFirstNode","ipAddressOfTheSecondNode","ipAddressOfTheThirdNode"]

discovery.type: zen
```

#### Data Nodes

If you want a node to be a data node add the following configuration:

```yml
node.roles: [ data, ingest ]
```

#### Cluster Manager

> [!NOTE]
> The nomenclature changed for the master node, it is now called cluster manager node.

For a node to be considered a master node, add the following:

```yml
node.roles: [ cluster_manager ]
```

#### TLS Configuration

##### Prerequisites

In the official help they suggest to use .pem files. However we recommend generating p12 keystore and truststore .p12 files using the script on GitHub [Generate-TLS-Certificates](https://github.com/SkylineCommunications/generate-tls-certificates).

It will generate.p12 files for every node. Place the correct .p12 file on each corresponding node. The GitHub script will provide you with the keystore and truststore password. This needs to be added to the keystore and truststore password fields in the OpenSearch.yml file:

A rootCA.crt will also be generated by the GitHub script.

> [!NOTE]
> The rootCA.crt can also be installed on a Windows machine by double-clicking it in case you want to query the OpenSearch from a different computer. As *Store Location* when adding the certificate, use *Local Machine* and place the certificate in *Trusted Root Certification Authorities*.
> It is the same procedure like when you would use Elastic, [Client-server TLS encryption](https://docs.dataminer.services/user-guide/Advanced_Functionality/Security/Advanced_security_configuration/Database_security/Security_Elasticsearch.html#client-server-tls-encryption). So once the certificate is imported, there is trust between your machine running DataMiner and the OpenSearch database/cluster.

###### Remove the demo-certificates

Remove the demo-certificates located in /etc/opensearch:

```bash
cd /etc/opensearch
```

```bash
sudo rm -f *pem
```

###### Update the trusted root certificates with rootCA.crt

Navigate to the location where your rootCA.crt file is stored and copy it using the following commands:

```bash
sudo cp rootCA.crt /usr/local/share/ca-certificates/
```

Next update the trusted root certificates:

```bash
sudo update-ca-certificates
```

You can verify the rootCA.crt using the following command, it should return the status OK.

```bash
openssl verify rootCA.crt
```

###### Configure users

Generate a new hash for the admin user using [Configure a user](https://opensearch.org/docs/latest/install-and-configure/install-opensearch/debian/#configure-a-user) section in the OpenSearch help. As the help indicated, remove all demo users except the *admin* user an replace the hash for admin with the generated hash.

##### Setup TLS in the OpenSearch.yml file

```yml
plugins.security.disabled: false

#Transport layer TLS
plugins.security.ssl.transport.keystore_type: PKCS12
plugins.security.ssl.transport.keystore_filepath: /etc/opensearch/cert/FQDNOfYourNode-node-keystore.p12
plugins.security.ssl.transport.keystore_password: ReplaceMeByGeneratedPasswordByGithubScript
plugins.security.ssl.transport.truststore_type: PKCS12
plugins.security.ssl.transport.truststore_filepath: /etc/opensearch/cert/FQDNOfYourNode-node-keystore.p12
plugins.security.ssl.transport.truststore_password: ReplaceMeByGeneratedPasswordByGithubScript

#REST Layer TLS
plugins.security.ssl.http.enabled: true
plugins.security.ssl.http.keystore_type: PKCS12
plugins.security.ssl.http.keystore_filepath: /etc/opensearch/cert/FQDNOfYourNode-node-keystore.p12
plugins.security.ssl.http.keystore_password: ReplaceMeByGeneratedPasswordByGithubScript
plugins.security.ssl.http.truststore_type: PKCS12
plugins.security.ssl.http.truststore_filepath: /etc/opensearch/cert/FQDNOfYourNode-node-keystore.p12
plugins.security.ssl.http.truststore_password: ReplaceMeByGeneratedPasswordByGithubScript

plugins.security.allow_default_init_securityindex: true
plugins.security.nodes_dn:
  - 'CN=FQDNOpenSearchNode1,OU=NameOfYourCluster,O=OpenSearch,C=BE'
  - 'CN=FQDNOpenSearchNode2,OU=NameOfYourCluster,O=OpenSearch,C=BE'
  - 'CN=FQDNOpenSearchNode3,OU=NameOfYourCluster,O=OpenSearch,C=BE'
plugins.security.audit.type: internal_opensearch
plugins.security.enable_snapshot_restore_privilege: true
plugins.security.check_snapshot_restore_write_privileges: true
plugins.security.restapi.roles_enabled: ["all_access", "security_rest_api_access"]
plugins.security.system_indices.enabled: true
plugins.security.system_indices.indices: [".plugins-ml-model", ".plugins-ml-task", ".opendistro-alerting-config", ".opendistro-alerting-alert*", ".opendistro-anomaly-results*", ".opendistro-anomaly-detector*", ".opendistro-anomaly-checkpoints", ".opendistro-anomaly-detection-state", ".opendistro-reports-*", ".opensearch-notifications-*", ".opensearch-notebooks", ".opensearch-observability", ".opendistro-asynchronous-search-response*", ".replication-metadata-store",".opendistro-anomaly-detection-state", ".opendistro-reports-*", ".opensearch-notifications-*", ".opensearch-notebooks", ".opensearch-observability", ".opendistro-asynchronous-search-response*", ".replication-metadata-store"]
node.max_local_storage_nodes: 3
indices.query.bool.max_clause_count: 2147483647
```

#### Restart OpenSearch

After the TLS configuration was done, and a different hash was set for the admin user, restart OpenSearch:

```bash
sudo systemctl restart opensearch
```

Check via the command-line if returns data:

```curl
curl https://your.host.address:9200 -u admin:yournewpassword --ssl-no-revoke
```

This should return the following:

```text
{
  "name" : "my-elasticsearch-node",
  "cluster_name" : "my-elasticsearch-cluster",
  "cluster_uuid" : "7kj65asfjuu9a1vcf6e345asd65dfg",
  "version" : {
    "distribution" : "opensearch",
    "number" : "2.6.0",
    "build_type" : "deb",
    "build_hash" : "abcdef1234567890",
    "build_date" : "2021-03-18T06:04:15.345676Z",
    "build_snapshot" : false,
    "lucene_version" : "9.5.0",
    "minimum_wire_compatibility_version" : "7.10.0",
    "minimum_index_compatibility_version" : "7.0.0"
  },
  "tagline" : "The OpenSearch Project: https://opensearch.org/"
}
```

### Querying the OpenSearch Database

#### ElasticVue

The OpenSearch database can be queried using a browser or you can use [ElasticVue](https://elasticvue.com/) browser extension.

> [!IMPORTANT]
> ElasticVue was created for ElasticSearch, we cannot guarantee everything will work.

#### OpenSearch Dashboards

It is also possible to set up OpenSearch Dashboards, which is the equivalent of Kibana for Elasticsearch. However, this is optional and not required for DataMiner to function.

Follow the installation guide at [Installing OpenSearch Dashboards (Debian)](https://opensearch.org/docs/latest/install-and-configure/install-dashboards/debian/). We recommend installing it on a Ubuntu Server(below is an example of configuration on Ubuntu server), either from an APT repository or using .deb-packages. You will be able to connect to your server using `http(s)://ipaddress:5601`.

##### Installation with TLS

The official documentation, [Configure TLS for OpenSearch Dashboards](https://opensearch.org/docs/latest/install-and-configure/install-dashboards/tls/) makes use of .pem certificates. However we recommend using .p12 files for trust and keystore. These .p12 files can be generated by the scripts [Generate TLS Certificates](https://github.com/SkylineCommunications/generate-tls-certificates), maintained by our Security team.

To configure OpenSearch Dashboards to use .p12 files add the following to `/etc/opensearch-dashboards/opensearch_dashboards.yml`:

```yaml
# OpenSearch Dashboards is served by a back end server. This setting specifies the port to use.
server.port: 5601

# Specifies the address to which the OpenSearch Dashboards server will bind. IP addresses and host names are both valid values.
# The default is 'localhost', which usually means remote machines will not be able to connect.
# To allow connections from remote users, set this parameter to a non-loopback address.
server.host: ipAddressComesHere

# The URLs of the OpenSearch instances to use for all your queries.
# Can be one ipAddress in case of a single node, but can also be multiple in case of an cluster, below is an example for a cluster consisting of three nodes
opensearch.hosts: ["https://ipAddressOfTheFirstNode:9200","https://ipAddressOfTheSecondNode:9200","https://ipAddressOfTheThirdNode:9200"]

# This setting is for communication between OpenSearch Dashboards and the web browser. Set to true for HTTPS, false for HTTP.
server.ssl.enabled: true

# In below example, we created a cert folder in /etc/opensearch and copied the .p12 files over that were generated with the generate-tls-certificates scripts.
server.ssl.keystore.path: "/etc/opensearch/cert/FQDN-node-keystore.p12"
server.ssl.keystore.password: "KeyStorePasswordComesHere"

# This setting is for communication between OpenSearch and OpenSearch Dashboards. Valid values are full, certificate, or none. We recommend full if you enable TLS, which enables hostname verification. certificate just checks the certificate, not the hostname, and none performs no checks (suitable for HTTP). Default is full.
opensearch.ssl.verificationMode: certificate

# If opensearch.ssl.verificationMode is full or certificate, specify the full path to one or more CA certificates that comprise a trusted chain for your OpenSearch cluster. For example, you might need to include a root CA and an intermediate CA if you used the intermediate CA to issue your admin, client, and node certificates.

# Below is an example of the rootCA.crt certificate that was generated using the generate-tls-certificates from the Skyline public GitHub repository. See also "Update the trusted root certificates with rootCA.crt" topic further up in this help file.
opensearch.ssl.certificateAuthorities: ["/usr/local/share/ca-certificates/rootCA.crt"]


# If your OpenSearch is protected with basic authentication(using the /etc/opensearch/opensearch-security/internal_users.yml), these settings provide the username and password that the OpenSearch Dashboards server uses to connect to OpenSearch.
# More information can be found here: https://opensearch.org/docs/latest/install-and-configure/install-opensearch/debian/#configure-a-user and https://opensearch.org/docs/latest/security/authentication-backends/authc-index/#authentication-flow
opensearch.username: userName
opensearch.password: pwd
```

See also the [official documentation](https://opensearch.org/docs/latest/) on how to set up your OpenSearch cluster in case something isn't covered.

> [!NOTE]
> Contrary to Elasticsearch, OpenSearch is only supported on Linux and not on Windows.

## Connecting your DMS to an OpenSearch cluster

To configure the connection to an OpenSearch database, configure the settings as detailed in [Cassandra database](xref:Configuring_the_database_settings_in_Cube#cassandra-database).

> [!IMPORTANT]
> An OpenSearch database requires a separate Cassandra cluster or Amazon Keyspaces.

## Troubleshooting

### Remote certificate invalid

```text
System.Net.Http.HttpRequestException: An error occurred while sending the request. ---> System.Net.WebException: The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel. ---> System.Security.Authentication.AuthenticationException: The remote certificate is invalid according to the validation procedure.
```

Above exception in the SLDBConnection logging can be fixed by adding the rootCA.crt in the  *Trusted Root Certification Authorities* store.

### Multiple DNS names for IP

In case multiple DNS names point to a single IP-address, set the below option to false in the opensearch.yml file:

```yaml
plugins.security.ssl.transport.resolve_hostname: false
```

See also [(Advanced) Hostname verification and DNS lookup](https://opensearch.org/docs/1.2/security-plugin/configuration/tls/#advanced-hostname-verification-and-dns-lookup).

### SLSearch.txt logging displays - OpenSearch version is not officially supported

You need to upgrade to DataMiner, starting from version 10.3.6.0 onwards. Then this will not be shown anymore in SLSearch.txt and the DataMiner software is then compatible.
